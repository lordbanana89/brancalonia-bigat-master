{
  "_id": "kbcYIZbuIuiHAqcp",
  "name": "üôè Invocazione ai Santi",
  "type": "script",
  "author": "Brancalonia",
  "img": "icons/magic/holy/prayer-hands-glowing-yellow.webp",
  "scope": "global",
  "command": "// INVOCAZIONE AI SANTI\\n// Sistema per invocare l'aiuto dei santi protettori\\n\\nconst actor = game.user.character || canvas.tokens.controlled[0]?.actor;\\nif (!actor) {\\n  ui.notifications.warn(\\\"Seleziona un personaggio!\\\");\\n  return;\\n}\\n\\n// Lista dei santi di Brancalonia\\nconst santi = {\\n  \\\"Sant'Orderico\\\": {\\n    dominio: \\\"Guerra e Battaglia\\\",\\n    bonus: \\\"Vantaggio su attacchi per 1 round\\\",\\n    cd: 12\\n  },\\n  \\\"Santa Coletta\\\": {\\n    dominio: \\\"Fortuna e Denaro\\\",\\n    bonus: \\\"Ritira 1 dado per la prossima ora\\\",\\n    cd: 10\\n  },\\n  \\\"San Pancrazio\\\": {\\n    dominio: \\\"Guarigione\\\",\\n    bonus: \\\"Cura 1d6 PF\\\",\\n    cd: 11\\n  },\\n  \\\"Sant'Arnaldo\\\": {\\n    dominio: \\\"Ladri e Furfanti\\\",\\n    bonus: \\\"Vantaggio su Furtivit√† per 10 minuti\\\",\\n    cd: 10\\n  },\\n  \\\"Santa Genoveffa\\\": {\\n    dominio: \\\"Protezione\\\",\\n    bonus: \\\"+2 CA per 1 minuto\\\",\\n    cd: 12\\n  },\\n  \\\"San Mamerto\\\": {\\n    dominio: \\\"Vino e Osterie\\\",\\n    bonus: \\\"Immune a veleni per 1 ora\\\",\\n    cd: 9\\n  }\\n};\\n\\n// Dialog per scegliere il santo\\nconst buttons = {};\\nfor (let [nome, info] of Object.entries(santi)) {\\n  buttons[nome] = {\\n    label: `${nome} (${info.dominio})`,\\n    callback: async () => {\\n      // Tiro Religione\\n      const roll = await actor.rollSkill(\\\"rel\\\", {\\n        flavor: `Invocazione a ${nome}`,\\n        targetValue: info.cd\\n      });\\n      \\n      const success = roll.total >= info.cd;\\n      \\n      // Messaggio risultato\\n      ChatMessage.create({\\n        speaker: ChatMessage.getSpeaker({actor}),\\n        content: `<h3>üôè Invocazione a ${nome}</h3>\\n        <p><strong>Santo del ${info.dominio}</strong></p>\\n        <p>Tiro Religione: [[${roll.total}]] vs CD ${info.cd}</p>\\n        <hr>\\n        ${success ? \\n          `<p style=\\\"color:green;\\\">‚ú® <strong>Il Santo risponde!</strong></p>\\n          <p><em>${info.bonus}</em></p>` :\\n          `<p style=\\\"color:red;\\\">üòî Il Santo ignora la tua preghiera...</p>\\n          <p><em>Riprova dopo il prossimo riposo.</em></p>`\\n        }`\\n      });\\n      \\n      // Applica effetti se successo\\n      if (success) {\\n        if (nome === \\\"San Pancrazio\\\") {\\n          const healing = await new Roll(\\\"1d6\\\").evaluate({async: true});\\n          await actor.applyDamage(-healing.total);\\n          ui.notifications.info(`Curati ${healing.total} PF!`);\\n        } else if (nome === \\\"Santa Genoveffa\\\") {\\n          const effect = {\\n            label: \\\"Benedizione di Santa Genoveffa\\\",\\n            icon: \\\"icons/magic/defensive/shield-barrier-glowing.webp\\\",\\n            duration: {rounds: 10},\\n            changes: [{\\n              key: \\\"system.attributes.ac.bonus\\\",\\n              mode: 2,\\n              value: 2\\n            }]\\n          };\\n          await actor.createEmbeddedDocuments(\\\"ActiveEffect\\\", [effect]);\\n        }\\n        // Segna uso giornaliero\\n        await actor.setFlag(\\\"world\\\", `santo_${nome}`, Date.now());\\n      }\\n    }\\n  };\\n}\\n\\nnew Dialog({\\n  title: \\\"Invoca un Santo Protettore\\\",\\n  content: `\\n    <h2>üôè Scegli il Santo da Invocare</h2>\\n    <p><em>Puoi invocare ogni santo una volta per riposo lungo.</em></p>\\n  `,\\n  buttons: buttons,\\n  default: Object.keys(buttons)[0]\\n}).render(true);",
  "ownership": {
    "default": 0
  },
  "flags": {
    "core": {
      "sourceId": "Macro.santi001"
    },
    "brancalonia-bigat": {
      "migrated": true,
      "version": "12.0.4"
    }
  },
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "3.3.1",
    "coreVersion": "13.347"
  },
  "_key": "!macros!santi001",
  "effects": [],
  "sort": 0,
  "folder": null,
  "system": {
    "identifier": "invocazionesanti",
    "source": "Brancalonia"
  }
}