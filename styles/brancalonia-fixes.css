/* ================================================ */
/* BRANCALONIA CRITICAL FIXES                      */
/* Compatibility patches without !important        */
/* ================================================ */

@layer module {
  /* ================================================
     FIX 1: Font Awesome Icons
     Using proper specificity instead of !important
     ================================================ */

  /* Ensure Font Awesome loads correctly with higher specificity */
  .theme-brancalonia i[class*="fa-"],
  .theme-brancalonia i[class*="fas"],
  .theme-brancalonia i[class*="far"],
  .theme-brancalonia i[class*="fab"],
  .theme-brancalonia .window-app i[class*="fa-"],
  .theme-brancalonia .sheet i[class*="fa-"] {
    font-family: "Font Awesome 6", "Font Awesome 6 Free", "Font Awesome 5 Free", "FontAwesome";
    font-style: normal;
    font-variant: normal;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    display: inline-block;
  }

  /* Correct weight for solid icons using cascade layers */
  .theme-brancalonia .fas,
  .theme-brancalonia i.fas,
  .theme-brancalonia .window-app .fas,
  .theme-brancalonia .sheet .fas {
    font-weight: 900;
  }

  /* Correct weight for regular icons */
  .theme-brancalonia .far,
  .theme-brancalonia i.far,
  .theme-brancalonia .window-app .far,
  .theme-brancalonia .sheet .far {
    font-weight: 400;
  }

  /* ================================================
     FIX 2: Character Sheet Profile Layout
     Scoped properly under theme class
     ================================================ */

  /* Fix main profile container */
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    position: relative;
  }

  /* Fix profile image */
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header .profile {
    position: relative;
    flex: 0 0 100px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid var(--bcl-gold);
    background: var(--bcl-paper-weak);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header .profile img,
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header .profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    display: block;
  }

  /* Fix character info layout */
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header .header-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  /* Fix character name */
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header h1.charname,
  .theme-brancalonia .dnd5e.sheet.actor.character .sheet-header input[name="name"] {
    margin: 0;
    padding: 0.25rem 0.5rem;
    background: transparent;
    border: none;
    border-bottom: 2px solid var(--bcl-gold);
    font-family: var(--bcl-font-display);
    font-size: 1.8rem;
    color: var(--bcl-ink-strong);
    width: 100%;
  }

  /* ================================================
     FIX 3: Attributes & Stats Layout
     ================================================ */

  /* Fix ability scores container */
  .theme-brancalonia .dnd5e.sheet.actor.character .ability-scores {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.5rem;
    background: var(--bcl-paper-weak);
    border-radius: var(--bcl-radius-md);
  }

  /* Fix single ability score */
  .theme-brancalonia .dnd5e.sheet.actor.character .ability {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    background: var(--bcl-paper);
    border: 1px solid var(--bcl-border);
    border-radius: var(--bcl-radius-sm);
    cursor: pointer;
    transition: all var(--bcl-transition-fast);
  }

  .theme-brancalonia .dnd5e.sheet.actor.character .ability:hover {
    background: var(--bcl-gold);
    transform: translateY(-2px);
    box-shadow: var(--bcl-shadow-md);
  }

  /* ================================================
     FIX 4: AC/HP/Initiative Layout
     ================================================ */

  /* Fix resource bars */
  .theme-brancalonia .dnd5e.sheet.actor.character .attributes {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 1rem;
    padding: 1rem;
    background: var(--bcl-paper-weak);
    border-radius: var(--bcl-radius-md);
    margin-top: 0.5rem;
  }

  .theme-brancalonia .dnd5e.sheet.actor.character .attribute {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0.75rem;
    background: var(--bcl-paper);
    border: 2px solid var(--bcl-gold);
    border-radius: var(--bcl-radius-md);
    transition: all var(--bcl-transition-fast);
  }

  .theme-brancalonia .dnd5e.sheet.actor.character .attribute:hover {
    transform: scale(1.05);
    box-shadow: var(--bcl-shadow-lg);
  }
}
  border-radius: 50%;
  width: 80px;
  height: 80px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.dnd5e.sheet.actor.character .attribute:hover {
  transform: scale(1.05);
  background: var(--bcl-gold, #C9A54A);
  color: var(--bcl-ink-strong, #1C140D);
}

/* ================================================
   FIX 5: Variabili CSS mancanti
   ================================================ */

/* Mapping variabili errate a quelle corrette */
.theme-brancalonia {
  /* Fix variabili con nome errato */
  --bcl-color-control-border: var(--bcl-border);
  --bcl-color-app-body-primary-fill: var(--bcl-paper);
  --bcl-color-app-body-primary-fill-1: var(--bcl-paper-weak);
  --bcl-color-app-header-fill-1: var(--bcl-paper-strong);
  --bcl-color-app-header-fill-2: var(--bcl-paper);
  --bcl-color-app-border: var(--bcl-border);
  --bcl-color-app-header-content: var(--bcl-ink-strong);
  --bcl-color-control-fill: var(--bcl-paper-weak);
  --bcl-color-control-highlight-fill: var(--bcl-gold);
  --bcl-color-control-highlight-border: var(--bcl-accent);
  --bcl-color-control-content: var(--bcl-ink-weak);
  --bcl-color-control-focus-content: var(--bcl-ink-strong);
  --bcl-color-app-body-content: var(--bcl-ink);
  --bcl-color-app-body-content-secondary: var(--bcl-ink-weak);
  --bcl-color-misc-inactive-content: var(--bcl-muted);
  --bcl-color-misc-fill: var(--bcl-paper-weak);
  --bcl-color-control-active-fill: var(--bcl-accent);
  --bcl-color-control-active-content: var(--bcl-paper);
  --bcl-color-control-active-border: var(--bcl-accent-strong);
  --bcl-color-misc-link-focus: var(--bcl-gold);
  --bcl-color-control-highlight-content: var(--bcl-ink-strong);
  --bcl-color-misc-shadow-highlight: var(--bcl-shadow-ink);
  --bcl-color-app-control-border: var(--bcl-border);
  --bcl-color-app-control-fill: var(--bcl-paper-weak);
  --bcl-color-app-section-border: var(--bcl-border);

  /* Fix radius variabili */
  --bcl-border-radius-small: var(--bcl-radius-sm);
  --bcl-border-radius-medium: var(--bcl-radius-md);
  --bcl-border-radius-large: var(--bcl-radius-lg);
}

/* ================================================
   FIX 6: Hit Points e Hit Dice
   ================================================ */

/* Fix HP display */
.dnd5e.sheet.actor.character .hit-points {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.dnd5e.sheet.actor.character .hit-points input {
  width: 3rem;
  text-align: center;
  background: var(--bcl-paper, #E7D6AE);
  border: 1px solid var(--bcl-border, #B99D6B);
  border-radius: var(--bcl-radius-sm, 4px);
  padding: 0.25rem;
  font-weight: bold;
  color: var(--bcl-ink-strong, #1C140D);
}

/* Fix Hit Dice */
.dnd5e.sheet.actor.character .hit-dice {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem;
  background: var(--bcl-paper-weak, #EFE0BD);
  border-radius: var(--bcl-radius-sm, 4px);
}

/* ================================================
   FIX 7: Tab Navigation
   ================================================ */

/* Fix tabs per essere visibili e cliccabili */
.dnd5e.sheet.actor .sheet-tabs {
  display: flex;
  gap: 0.25rem;
  border-bottom: 2px solid var(--bcl-border, #B99D6B);
  margin: 1rem 0;
  padding: 0;
}

.dnd5e.sheet.actor .sheet-tabs .item {
  padding: 0.5rem 1rem;
  background: var(--bcl-paper-weak, #EFE0BD);
  border: 1px solid var(--bcl-border, #B99D6B);
  border-bottom: none;
  border-radius: var(--bcl-radius-sm, 4px) var(--bcl-radius-sm, 4px) 0 0;
  cursor: pointer;
  transition: all 0.2s ease;
  color: var(--bcl-ink, #2B1F14);
  text-decoration: none;
}

.dnd5e.sheet.actor .sheet-tabs .item:hover {
  background: var(--bcl-gold, #C9A54A);
  color: var(--bcl-ink-strong, #1C140D);
}

.dnd5e.sheet.actor .sheet-tabs .item.active {
  background: var(--bcl-accent, #8C2B27);
  color: var(--bcl-paper, #E7D6AE);
  font-weight: bold;
}

/* ================================================
   FIX 8: Brancalonia Specific Elements
   ================================================ */

/* Fix variabili Brancalonia specifiche */
.theme-brancalonia {
  --brancalonia-wine: var(--bcl-accent, #8C2B27);
  --brancalonia-wine-dark: var(--bcl-accent-strong, #5E1715);
  --brancalonia-gold-dark: var(--bcl-gold, #C9A54A);
  --brancalonia-terracotta: #CB6843;
  --brancalonia-gold: var(--bcl-gold, #C9A54A);
}

/* Fix Infamia tracker */
.infamia-tracker {
  background: linear-gradient(135deg, var(--bcl-accent-strong, #5E1715), var(--bcl-accent, #8C2B27));
  border: 2px solid var(--bcl-gold, #C9A54A);
  border-radius: var(--bcl-radius-md, 8px);
  padding: 1rem;
  margin: 1rem 0;
  color: var(--bcl-paper, #E7D6AE);
}

/* Fix Baraonda tracker */
.baraonda-tracker {
  background: linear-gradient(135deg, #CB6843, var(--bcl-gold, #C9A54A));
  border: 2px solid var(--bcl-gold, #C9A54A);
  border-radius: var(--bcl-radius-md, 8px);
  padding: 1rem;
  margin: 1rem 0;
  color: var(--bcl-ink-strong, #1C140D);
}